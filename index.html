<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Clasifica el Balance - EBAU 2¬∫ Bachillerato</title>
    <style>
        /* ========== VARIABLES DE COLOR ========== */
        :root {
            --color-activo: #4CAF50;
            --color-pasivo: #F44336;
            --color-patrimonio: #2196F3;
            --color-no-corriente: #9C27B0;
            --color-corriente: #FF9800;
            --color-fondo: #1a1a2e;
            --color-secundario: #16213e;
            --color-terciario: #0f3460;
            --color-texto: #e6e6e6;
            --color-acierto: #4CAF50;
            --color-error: #F44336;
            --color-info: #2196F3;
            --color-warning: #FFC107;
        }

        /* ========== ESTILOS GENERALES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--color-fondo) 0%, var(--color-secundario) 100%);
            color: var(--color-texto);
            min-height: 100vh;
            padding: 20px;
        }

        /* ========== CONTENEDOR PRINCIPAL ========== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ========== CABECERA ========== */
        header {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--color-activo), var(--color-patrimonio), var(--color-pasivo));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2em;
            color: var(--color-warning);
            margin-top: 10px;
        }

        /* ========== BOT√ìN DE M√öSICA ========== */
        .music-control {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-info), #0D47A1);
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .music-control:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.6);
        }

        .music-control.active {
            background: linear-gradient(135deg, var(--color-acierto), #2E7D32);
            animation: pulseMusic 2s infinite;
        }

        @keyframes pulseMusic {
            0%, 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
        }

        /* ========== PANEL DE INFORMACI√ìN ========== */
        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .info-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        .info-box.score {
            border-color: var(--color-warning);
        }

        .info-box.timer {
            border-color: var(--color-error);
        }

        .info-box.level {
            border-color: var(--color-info);
        }

        .info-box h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .info-value {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .score-value { color: var(--color-warning); }
        .timer-value { color: var(--color-error); }
        .level-value { color: var(--color-info); }

        /* ========== SECCI√ìN DE JUEGO ========== */
        .game-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .element-card {
            background: linear-gradient(135deg, var(--color-secundario), var(--color-terciario));
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            border: 3px solid var(--color-warning);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
        }

        .element-name {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--color-warning);
        }

        .element-description {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* ========== PREGUNTAS DE ORIENTACI√ìN ========== */
        .questions-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .question-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: var(--color-info);
            text-align: center;
        }

        .question {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid var(--color-warning);
        }

        .question-text {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        /* ========== BOTONES DE RESPUESTA ========== */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .option-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .option-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .option-btn:active {
            transform: translateY(1px);
        }

        .btn-activo { 
            background: linear-gradient(135deg, var(--color-activo), #2E7D32); 
            color: white;
        }

        .btn-pasivo { 
            background: linear-gradient(135deg, var(--color-pasivo), #C62828); 
            color: white;
        }

        .btn-patrimonio { 
            background: linear-gradient(135deg, var(--color-patrimonio), #0D47A1); 
            color: white;
        }

        .btn-no-corriente { 
            background: linear-gradient(135deg, var(--color-no-corriente), #4A148C); 
            color: white;
        }

        .btn-corriente { 
            background: linear-gradient(135deg, var(--color-corriente), #E65100); 
            color: white;
        }

        .btn-submasa {
            background: linear-gradient(135deg, #673AB7, #311B92);
            color: white;
        }

        /* ========== FEEDBACK ========== */
        .feedback {
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback.correct {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid var(--color-acierto);
            color: var(--color-acierto);
            display: block;
        }

        .feedback.incorrect {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid var(--color-error);
            color: var(--color-error);
            display: block;
        }

        .feedback-description {
            font-size: 1em;
            margin-top: 10px;
            line-height: 1.6;
        }

        /* ========== BOTONES DE CONTROL ========== */
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        .control-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .control-btn:active {
            transform: translateY(1px);
        }

        .btn-next {
            background: linear-gradient(135deg, var(--color-acierto), #2E7D32);
            color: white;
        }

        .btn-retry {
            background: linear-gradient(135deg, var(--color-warning), #FF8F00);
            color: #333;
        }

        .btn-menu {
            background: linear-gradient(135deg, var(--color-info), #0D47A1);
            color: white;
        }

        /* ========== MODAL DE RESULTADOS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--color-secundario), var(--color-terciario));
            padding: 40px;
            border-radius: 25px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            border: 3px solid var(--color-warning);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlide 0.5s ease;
        }

        @keyframes modalSlide {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: var(--color-warning);
        }

        .modal-stats {
            font-size: 1.3em;
            margin: 20px 0;
            line-height: 2;
        }

        .modal-btns {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        /* ========== NIVELES ========== */
        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .level-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid var(--color-info);
        }

        .level-btn:hover {
            background: rgba(33, 150, 243, 0.3);
            transform: scale(1.05);
        }

        .level-btn.active {
            background: rgba(33, 150, 243, 0.6);
            border-color: var(--color-warning);
        }

        /* ========== PROGRESS BAR ========== */
        .progress-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 20px;
            background: linear-gradient(90deg, var(--color-activo), var(--color-patrimonio), var(--color-pasivo));
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        /* ========== ANIMACIONES ========== */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .bounce {
            animation: bounce 1s ease;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .subtitle {
                font-size: 1em;
            }

            .music-control {
                width: 40px;
                height: 40px;
                font-size: 1.2em;
                top: 10px;
                right: 10px;
            }

            .info-panel {
                grid-template-columns: 1fr;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .control-buttons {
                flex-direction: column;
            }

            .control-btn {
                width: 100%;
            }

            .modal-content {
                padding: 25px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .game-section {
                padding: 20px;
            }

            .element-name {
                font-size: 1.5em;
            }

            .info-value {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- AUDIO PLAYER (OCULTO) -->
    <audio id="bgMusic" src="1_Balance.mp3.mpeg" loop></audio>

    <div class="container">
        <!-- ========== CABECERA ========== -->
        <header>
            <button class="music-control" id="musicBtn" onclick="toggleMusic()">üéµ</button>
            <h1>üéÆ Clasifica el Balance</h1>
            <p class="subtitle">Aprende las masas y submasas patrimoniales del balance EBAU</p>
        </header>

        <!-- ========== PANEL DE INFORMACI√ìN ========== -->
        <div class="info-panel">
            <div class="info-box score">
                <h3>Puntuaci√≥n</h3>
                <span class="info-value score-value" id="score">0</span>
            </div>
            <div class="info-box timer">
                <h3>‚è∞ Tiempo</h3>
                <span class="info-value timer-value" id="timer">60</span>
            </div>
            <div class="info-box level">
                <h3>üìä Nivel</h3>
                <span class="info-value level-value" id="level">1</span>
            </div>
        </div>

        <!-- ========== SELECCI√ìN DE NIVEL ========== -->
        <div class="game-section" id="levelSelection">
            <h2>üéØ Selecciona tu nivel de dificultad</h2>
            <div class="level-selector">
                <button class="level-btn active" data-level="1">Nivel 1<br><small>Principiante</small></button>
                <button class="level-btn" data-level="2">Nivel 2<br><small>Intermedio</small></button>
                <button class="level-btn" data-level="3">Nivel 3<br><small>Experto</small></button>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="control-btn btn-next" onclick="startGame()">üéÆ ¬°Comenzar!</button>
            </div>
        </div>

        <!-- ========== JUEGO ========== -->
        <div class="game-section" id="gameSection" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>

            <!-- ELEMENTO A CLASIFICAR -->
            <div class="element-card">
                <div class="element-name" id="elementName">Cargando...</div>
                <div class="element-description" id="elementDescription">...</div>
            </div>

            <!-- PREGUNTAS DE ORIENTACI√ìN -->
            <div class="questions-section">
                <div class="question-title">üí° Preguntas de orientaci√≥n</div>
                <div class="question">
                    <div class="question-text" id="question1">¬øEs algo que tengo o me deben?</div>
                </div>
                <div class="question">
                    <div class="question-text" id="question2">¬øSe espera recuperarlo en menos de un a√±o?</div>
                </div>
            </div>

            <!-- OPCIONES DE RESPUESTA -->
            <div class="options-grid" id="optionsGrid">
                <!-- Las opciones se generar√°n din√°micamente -->
            </div>

            <!-- FEEDBACK -->
            <div class="feedback" id="feedback">
                <div id="feedbackText">¬°Correcto!</div>
                <div class="feedback-description" id="feedbackDescription"></div>
            </div>

            <!-- BOTONES DE CONTROL -->
            <div class="control-buttons">
                <button class="control-btn btn-next" id="nextBtn" onclick="nextQuestion()" style="display: none;">‚è≠Ô∏è Siguiente</button>
                <button class="control-btn btn-retry" id="retryBtn" onclick="retryQuestion()" style="display: none;">üîÑ Reintentar</button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE RESULTADOS ========== -->
    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <h2>üéâ ¬°Juego completado!</h2>
            <div class="modal-stats">
                <p>Puntuaci√≥n final: <strong id="finalScore">0</strong> puntos</p>
                <p>Tiempo restante: <strong id="finalTime">0</strong> segundos</p>
                <p>Nivel completado: <strong id="finalLevel">1</strong></p>
            </div>
            <div class="modal-btns">
                <button class="control-btn btn-menu" onclick="restartGame()">üè† Men√∫ principal</button>
                <button class="control-btn btn-next" onclick="nextLevel()">‚¨ÜÔ∏è Subir nivel</button>
            </div>
        </div>
    </div>

    <script>
        // ========== VARIABLES DE M√öSICA ==========
        const bgMusic = document.getElementById('bgMusic');
        const musicBtn = document.getElementById('musicBtn');
        let isMusicPlaying = false;

        // ========== CONTROL DE M√öSICA ==========
        function toggleMusic() {
            if (bgMusic.paused) {
                // Intentar reproducir
                bgMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicBtn.classList.add('active');
                    musicBtn.innerHTML = 'üîä';
                }).catch(error => {
                    console.log('Reproducci√≥n autom√°tica bloqueada:', error);
                    alert('‚ö†Ô∏è Para activar la m√∫sica, haz clic en cualquier parte de la p√°gina primero.');
                });
            } else {
                // Pausar m√∫sica
                bgMusic.pause();
                isMusicPlaying = false;
                musicBtn.classList.remove('active');
                musicBtn.innerHTML = 'üîá';
            }
        }

        // ========== DATOS DEL JUEGO ==========
        const balanceData = {
            // NIVEL 1: MASAS PRINCIPALES
            level1: [
                {
                    element: "Efectivo en caja",
                    description: "Dinero en met√°lico que tiene la empresa disponible",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera recuperarlo en menos de un a√±o?",
                    correctAnswer: "Activo",
                    feedback: "¬°Correcto! El efectivo es un ACTIVO porque es algo que la empresa tiene y le pertenece."
                },
                {
                    element: "Maquinaria",
                    description: "Equipos e instalaciones utilizados en la producci√≥n",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera recuperarlo en menos de un a√±o?",
                    correctAnswer: "Activo",
                    feedback: "¬°Correcto! La maquinaria es un ACTIVO porque es un bien que posee la empresa para su actividad."
                },
                {
                    element: "Capital Social",
                    description: "Aportaciones de los socios o accionistas",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øRepresenta una deuda de la empresa?",
                    correctAnswer: "Patrimonio Neto",
                    feedback: "¬°Correcto! El capital social es PATRIMONIO NETO porque representa los recursos propios aportados por los due√±os."
                },
                {
                    element: "Pr√©stamo bancario a 5 a√±os",
                    description: "Dinero prestado al banco con devoluci√≥n en 5 a√±os",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øRepresenta una deuda de la empresa?",
                    correctAnswer: "Pasivo",
                    feedback: "¬°Correcto! El pr√©stamo es un PASIVO porque es una deuda que la empresa debe pagar."
                },
                {
                    element: "Clientes",
                    description: "Personas o empresas que nos deben dinero por ventas",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera cobrarlo en menos de un a√±o?",
                    correctAnswer: "Activo",
                    feedback: "¬°Correcto! Los clientes son un ACTIVO porque representan derechos de cobro de la empresa."
                },
                {
                    element: "Proveedores",
                    description: "Empresas a las que debemos dinero por compras",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øRepresenta una deuda de la empresa?",
                    correctAnswer: "Pasivo",
                    feedback: "¬°Correcto! Los proveedores son un PASIVO porque son deudas que la empresa debe pagar."
                },
                {
                    element: "Terrenos",
                    description: "Terrenos propiedad de la empresa",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera recuperarlo en menos de un a√±o?",
                    correctAnswer: "Activo",
                    feedback: "¬°Correcto! Los terrenos son un ACTIVO porque son bienes que posee la empresa."
                },
                {
                    element: "Reservas",
                    description: "Beneficios acumulados no distribuidos",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øRepresenta una deuda de la empresa?",
                    correctAnswer: "Patrimonio Neto",
                    feedback: "¬°Correcto! Las reservas son PATRIMONIO NETO porque son beneficios acumulados de la empresa."
                }
            ],
            
            // NIVEL 2: NO CORRIENTE vs CORRIENTE
            level2: [
                {
                    element: "Construcciones",
                    description: "Edificios y naves industriales propiedad de la empresa",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera recuperarlo en menos de un a√±o?",
                    correctAnswer: "Activo No Corriente",
                    feedback: "¬°Correcto! Las construcciones son ACTIVO NO CORRIENTE porque son bienes duraderos que se utilizan m√°s de un a√±o."
                },
                {
                    element: "Existencias de productos terminados",
                    description: "Productos fabricados listos para vender",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera recuperarlo en menos de un a√±o?",
                    correctAnswer: "Activo Corriente",
                    feedback: "¬°Correcto! Las existencias son ACTIVO CORRIENTE porque se espera venderlas en menos de un a√±o."
                },
                {
                    element: "Deudas a largo plazo con bancos",
                    description: "Pr√©stamos bancarios con vencimiento superior a un a√±o",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe debe pagar en m√°s de un a√±o?",
                    correctAnswer: "Pasivo No Corriente",
                    feedback: "¬°Correcto! Las deudas a L/P son PASIVO NO CORRIENTE porque se pagar√°n en m√°s de un a√±o."
                },
                {
                    element: "Deudas a corto plazo con bancos",
                    description: "Pr√©stamos bancarios con vencimiento inferior a un a√±o",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe debe pagar en menos de un a√±o?",
                    correctAnswer: "Pasivo Corriente",
                    feedback: "¬°Correcto! Las deudas a C/P son PASIVO CORRIENTE porque se pagar√°n en menos de un a√±o."
                },
                {
                    element: "Aplicaciones inform√°ticas",
                    description: "Software y programas propiedad de la empresa",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera recuperarlo en menos de un a√±o?",
                    correctAnswer: "Activo No Corriente",
                    feedback: "¬°Correcto! Las aplicaciones inform√°ticas son ACTIVO NO CORRIENTE porque son bienes intangibles duraderos."
                },
                {
                    element: "Bancos",
                    description: "Dinero depositado en cuentas corrientes",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera recuperarlo en menos de un a√±o?",
                    correctAnswer: "Activo Corriente",
                    feedback: "¬°Correcto! El dinero en bancos es ACTIVO CORRIENTE porque est√° disponible para usar en cualquier momento."
                }
            ],
            
            // NIVEL 3: SUBMASAS COMPLETAS
            level3: [
                {
                    element: "Propiedad industrial",
                    description: "Patentes, marcas y derechos de autor",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øEs un bien tangible o intangible?",
                    correctAnswer: "Inmovilizado Intangible",
                    feedback: "¬°Correcto! La propiedad industrial es INMOVILIZADO INTANGIBLE porque son derechos sin forma f√≠sica pero con valor econ√≥mico."
                },
                {
                    element: "Materias primas",
                    description: "Materiales que se transformar√°n en productos",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe transformar√° en producto terminado?",
                    correctAnswer: "Existencias",
                    feedback: "¬°Correcto! Las materias primas son EXISTENCIAS porque son bienes que se transformar√°n en productos terminados."
                },
                {
                    element: "Clientes",
                    description: "Personas que nos deben dinero por ventas a cr√©dito",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe espera cobrarlo en menos de un a√±o?",
                    correctAnswer: "Realizable",
                    feedback: "¬°Correcto! Los clientes son REALIZABLE porque son derechos de cobro que se esperan recuperar en menos de un a√±o."
                },
                {
                    element: "Caja",
                    description: "Dinero en met√°lico disponible",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øEst√° inmediatamente disponible?",
                    correctAnswer: "Disponible",
                    feedback: "¬°Correcto! La caja es DISPONIBLE porque es dinero en efectivo que est√° inmediatamente disponible para la empresa."
                },
                {
                    element: "Reserva legal",
                    description: "Parte de beneficios obligatoria para fortalecer patrimonio",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øEs una aportaci√≥n de socios o beneficio acumulado?",
                    correctAnswer: "Reservas",
                    feedback: "¬°Correcto! La reserva legal es una RESERVA porque es una parte obligatoria de los beneficios acumulados."
                },
                {
                    element: "Proveedores",
                    description: "Empresas a las que debemos por compras a cr√©dito",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe debe pagar en menos de un a√±o?",
                    correctAnswer: "Pasivo Corriente",
                    feedback: "¬°Correcto! Los proveedores son PASIVO CORRIENTE porque son deudas comerciales que se pagan en menos de un a√±o."
                },
                {
                    element: "Instalaciones t√©cnicas",
                    description: "Sistemas y equipos instalados en la empresa",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øTiene forma f√≠sica y duraci√≥n superior a un a√±o?",
                    correctAnswer: "Inmovilizado Material",
                    feedback: "¬°Correcto! Las instalaciones t√©cnicas son INMOVILIZADO MATERIAL porque son bienes tangibles de larga duraci√≥n."
                },
                {
                    element: "Inversiones financieras a largo plazo",
                    description: "Participaciones en otras empresas con intenci√≥n de mantener",
                    question1: "¬øEs algo que tengo o me deben?",
                    question2: "¬øSe mantendr√° m√°s de un a√±o?",
                    correctAnswer: "Inversiones Financieras L/P",
                    feedback: "¬°Correcto! Las inversiones financieras a L/P son para mantener participaciones en otras empresas durante largo tiempo."
                }
            ]
        };

        // ========== VARIABLES DEL JUEGO ==========
        let currentLevel = 1;
        let currentQuestionIndex = 0;
        let score = 0;
        let timeLeft = 60;
        let timerInterval;
        let gameActive = false;

        // ========== FUNCIONES DEL JUEGO ==========
        
        // Seleccionar nivel
        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentLevel = parseInt(this.dataset.level);
                document.getElementById('level').textContent = currentLevel;
            });
        });

        // Iniciar juego
        function startGame() {
            gameActive = true;
            currentQuestionIndex = 0;
            score = 0;
            timeLeft = 60;
            
            document.getElementById('levelSelection').style.display = 'none';
            document.getElementById('gameSection').style.display = 'block';
            document.getElementById('score').textContent = score;
            
            // Iniciar temporizador
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
            
            loadQuestion();
        }

        // Cargar pregunta
        function loadQuestion() {
            const questions = balanceData[`level${currentLevel}`];
            
            if (currentQuestionIndex >= questions.length) {
                endGame();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            
            // Actualizar progreso
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Mostrar elemento
            document.getElementById('elementName').textContent = question.element;
            document.getElementById('elementDescription').textContent = question.description;
            
            // Mostrar preguntas de orientaci√≥n
            document.getElementById('question1').textContent = question.question1;
            document.getElementById('question2').textContent = question.question2;
            
            // Generar opciones
            generateOptions(question.correctAnswer);
            
            // Limpiar feedback
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('retryBtn').style.display = 'none';
        }

        // Generar opciones seg√∫n el nivel
        function generateOptions(correctAnswer) {
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            let options = [];
            
            if (currentLevel === 1) {
                options = ["Activo", "Pasivo", "Patrimonio Neto"];
            } else if (currentLevel === 2) {
                options = ["Activo No Corriente", "Activo Corriente", "Pasivo No Corriente", "Pasivo Corriente"];
            } else {
                options = [
                    "Inmovilizado Intangible",
                    "Inmovilizado Material", 
                    "Existencias",
                    "Realizable",
                    "Disponible",
                    "Reservas",
                    "Inversiones Financieras L/P"
                ];
            }
            
            // Mezclar opciones
            options = shuffleArray(options);
            
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                
                if (currentLevel === 1) {
                    if (option === "Activo") btn.classList.add('btn-activo');
                    else if (option === "Pasivo") btn.classList.add('btn-pasivo');
                    else if (option === "Patrimonio Neto") btn.classList.add('btn-patrimonio');
                } else if (currentLevel === 2) {
                    if (option.includes("No Corriente")) btn.classList.add('btn-no-corriente');
                    else if (option.includes("Corriente")) btn.classList.add('btn-corriente');
                } else {
                    btn.classList.add('btn-submasa');
                }
                
                btn.onclick = () => checkAnswer(option, correctAnswer);
                optionsGrid.appendChild(btn);
            });
        }

        // Verificar respuesta
        function checkAnswer(selected, correct) {
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            const feedbackDescription = document.getElementById('feedbackDescription');
            
            if (selected === correct) {
                // Respuesta correcta
                feedback.className = 'feedback correct';
                feedbackText.textContent = '‚úÖ ¬°Correcto!';
                feedbackDescription.textContent = balanceData[`level${currentLevel}`][currentQuestionIndex].feedback;
                
                score += 10;
                document.getElementById('score').textContent = score;
                
                document.getElementById('nextBtn').style.display = 'block';
            } else {
                // Respuesta incorrecta
                feedback.className = 'feedback incorrect';
                feedbackText.textContent = '‚ùå Incorrecto';
                feedbackDescription.textContent = `La respuesta correcta es: ${correct}`;
                
                timeLeft -= 5;
                if (timeLeft < 0) timeLeft = 0;
                
                document.getElementById('retryBtn').style.display = 'block';
            }
            
            // Deshabilitar botones
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correct) {
                    btn.style.backgroundColor = 'rgba(76, 175, 80, 0.5)';
                }
                if (btn.textContent === selected && selected !== correct) {
                    btn.style.backgroundColor = 'rgba(244, 67, 54, 0.5)';
                }
            });
        }

        // Siguiente pregunta
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // Reintentar pregunta
        function retryQuestion() {
            loadQuestion();
        }

        // Actualizar temporizador
        function updateTimer() {
            timeLeft--;
            document.getElementById('timer').textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                endGame();
            }
        }

        // Terminar juego
        function endGame() {
            clearInterval(timerInterval);
            gameActive = false;
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalTime').textContent = timeLeft;
            document.getElementById('finalLevel').textContent = currentLevel;
            
            document.getElementById('resultsModal').style.display = 'flex';
        }

        // Reiniciar juego
        function restartGame() {
            document.getElementById('resultsModal').style.display = 'none';
            document.getElementById('gameSection').style.display = 'none';
            document.getElementById('levelSelection').style.display = 'block';
        }

        // Subir nivel
        function nextLevel() {
            document.getElementById('resultsModal').style.display = 'none';
            
            if (currentLevel < 3) {
                currentLevel++;
                document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`.level-btn[data-level="${currentLevel}"]`).classList.add('active');
                document.getElementById('level').textContent = currentLevel;
            }
            
            startGame();
        }

        // Funci√≥n para mezclar array (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ========== INICIAR M√öSICA AL INTERACTUAR ==========
        document.addEventListener('click', function() {
            // Intentar iniciar m√∫sica si no est√° reproduciendo
            if (!isMusicPlaying && bgMusic.paused) {
                bgMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicBtn.classList.add('active');
                    musicBtn.innerHTML = 'üîä';
                }).catch(error => {
                    // Silenciosamente manejar el error
                });
            }
        }, { once: true });
    </script>
</body>
</html>